<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sign In / Sign Out</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
    form {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    input, select, button {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 14px;
    }
    button {
      cursor: pointer;
      background: #0077ff;
      color: white;
      border: none;
      transition: background 0.2s;
    }
    button:hover {
      background: #005fcc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    .status {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 5px;
      font-weight: bold;
    }
    .status.out {
      background: #ffe0e0;
      color: #a00;
    }
    .status.in {
      background: #e0ffe0;
      color: #060;
    }
    .passcode {
      margin-top: 10px;
      padding: 8px;
      background: #e8f0ff;
      border: 1px solid #99c;
      border-radius: 5px;
      font-size: 14px;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Sign In / Sign Out</h1>

    <div id="statusBox" class="status"></div>

    <form id="signForm">
      <input type="text" id="user" placeholder="Enter Your Name" required />
      <input type="text" id="passcode" placeholder="Passcode (for sign in)" />
      <select id="mode">
        <option value="out">Sign Out</option>
        <option value="in">Sign In</option>
      </select>
      <button type="submit">Submit</button>
    </form>

    <div id="passcodeBox" class="passcode"></div>

    <table id="recordsTable">
      <thead>
        <tr>
          <th>User</th>
          <th>Passcode</th>
          <th>Signed Out</th>
          <th>Signed In</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const form = document.getElementById("signForm");
    const tableBody = document.querySelector("#recordsTable tbody");
    const statusBox = document.getElementById("statusBox");
    const modeSelect = document.getElementById("mode");
    const passcodeBox = document.getElementById("passcodeBox");

    let records = JSON.parse(localStorage.getItem("signRecords") || "[]");
    let passcodeCounter = parseInt(localStorage.getItem("passcodeCounter") || "1");

    function render() {
      tableBody.innerHTML = "";
      records.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.user}</td>
          <td>${r.passcode}</td>
          <td>${r.signedOut ? new Date(r.signedOut).toLocaleString() : "-"}</td>
          <td>${r.signedIn ? new Date(r.signedIn).toLocaleString() : "<span class='out'>Still Out</span>"}</td>
        `;
        tableBody.appendChild(tr);
      });

      // check if someone currently has the camera
      const active = records.find(r => !r.signedIn);
      if (active) {
        statusBox.textContent = `ðŸ“· Camera is currently with ${active.user}`;
        statusBox.className = "status out";
        // disable Sign Out option
        modeSelect.value = "in";
        modeSelect.querySelector("option[value='out']").disabled = true;
      } else {
        statusBox.textContent = "âœ… Camera is available";
        statusBox.className = "status in";
        // enable Sign Out option
        modeSelect.querySelector("option[value='out']").disabled = false;
      }
    }

    form.addEventListener("submit", e => {
      e.preventDefault();
      const user = document.getElementById("user").value.trim();
      const mode = document.getElementById("mode").value;
      const enteredPasscode = document.getElementById("passcode").value.trim();

      if (!user) return alert("Please enter your name.");

      if (mode === "out") {
        // only allow if no one has it
        const active = records.find(r => !r.signedIn);
        if (active) {
          alert("Camera is already signed out by " + active.user);
          return;
        }
        // generate passcode: Name + counter
        const passcode = user + passcodeCounter;
        passcodeCounter++;
        localStorage.setItem("passcodeCounter", passcodeCounter);

        records.unshift({
          user,
          passcode,
          signedOut: new Date().toISOString(),
          signedIn: null
        });

        passcodeBox.textContent = `ðŸ”‘ Your passcode is: ${passcode}. Youâ€™ll need this to sign the camera back in.`;
        passcodeBox.style.display = "block";
      } else {
        // sign in requires passcode match
        const record = records.find(r => 
          r.user.toLowerCase() === user.toLowerCase() && !r.signedIn
        );
        if (!record) {
          alert("No active sign-out found for " + user);
          return;
        }
        if (enteredPasscode !== record.passcode) {
          alert("Incorrect passcode. Please enter the correct one.");
          return;
        }
        record.signedIn = new Date().toISOString();
        passcodeBox.style.display = "none";
      }

      localStorage.setItem("signRecords", JSON.stringify(records));
      render();
      form.reset();
    });

    render();
  </script>
</body>
</html>
